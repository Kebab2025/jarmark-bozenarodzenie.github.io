<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Kasa Świąteczna</title>
<style>
body { font-family: Arial, sans-serif; margin:20px; background:#fafafa; color:#111; }
h1 { text-align:center; }
.grid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:20px; }
button { padding:12px; font-size:16px; border-radius:10px; cursor:pointer; border:1px solid #ccc; background:#eee; }
button:hover { background:#ddd; }
#koszyk, #paragon, #paragonKuchnia { background:#f0f0f0; padding:15px; border-radius:10px; margin-bottom:20px; white-space:pre-wrap; }
#platnoscDiv, #komunikatDiv, #produktyDiv { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:white; padding:20px; border-radius:15px; box-shadow:0 0 15px rgba(0,0,0,0.5); z-index:1001; width:350px; text-align:center; max-height:90%; overflow:auto; }
#overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; }
#resztaText { margin-top:15px; font-weight:bold; }
.dark { background:#111; color:#eee; }
.dark #koszyk, .dark #paragon, .dark #paragonKuchnia { background:#222; }
#loginDiv { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#fff; padding:20px; border-radius:15px; box-shadow:0 0 15px rgba(0,0,0,0.5);
  width:320px; text-align:center; z-index:2000; }
.notaBtn { margin-left:5px; font-size:14px; padding:4px 8px; }
#modalInput, #nowaNazwa, #nowaCena { width: 90%; padding: 5px; margin-top: 10px; margin-bottom: 10px; display:block; }
#szukajProduktow { width:95%; padding:6px; margin-bottom:10px; font-size:16px; border-radius:8px; border:1px solid #ccc; }
</style>
</head>
<body>

<div id="loginDiv">
<h2>🔑 Logowanie kasjera</h2>
<input type="text" id="loginUser" placeholder="Login"><br><br>
<input type="password" id="loginPass" placeholder="Hasło"><br><br>
<button onclick="zaloguj()">Zaloguj</button>
</div>

<div id="app" style="display:none;">
<h1>🎄 Kasa Świąteczna 🎅</h1>
<p id="kasjerInfo"></p>
<button onclick="wyloguj()">🚪 Wyloguj</button>
<button onclick="toggleDarkMode()">🌙/☀️ Tryb</button>
<hr>

<input type="text" id="szukajProduktow" oninput="filtrujProdukty()" placeholder="🔍 Wyszukaj produkt...">

<h2>🍔 Jedzenie</h2>
<div class="grid" id="jedzenieGrid"></div>

<h2>🍰 Desery</h2>
<div class="grid" id="deseryGrid"></div>

<h2>🥤 Napoje</h2>
<div class="grid" id="napojeGrid"></div>

<h2>Koszyk:</h2>
<div id="koszyk">Koszyk jest pusty.</div>

<button onclick="wybierzPlatnosc()">🧾 Wystaw paragon</button>
<button onclick="resetuj()">❌ Resetuj</button>
<button onclick="otworzKodPromocyjny()">🎁 Kod promocyjny</button>
<button onclick="otworzProdukty()">⚙️ Zarządzaj produktami</button>

<div id="overlay"></div>

<div id="platnoscDiv">
<h3>Wybierz formę płatności:</h3>
<select id="platnoscSelect" onchange="aktualizujWalute()">
<option value="PLN">Gotówka (PLN)</option>
<option value="USD">USD</option>
<option value="EUR">EUR</option>
<option value="BLIK">BLIK</option>
</select>
<div id="gotowkaInputDiv">
<label>Kwota od klienta: </label>
<input type="number" id="gotowkaInput" min="0" step="0.01">
</div>
<div id="resztaText"></div>
<button onclick="zatwierdzPlatnosc()">Zatwierdź płatność</button>
</div>

<div id="komunikatDiv">
<p id="komunikatText"></p>
<input type="text" id="modalInput" placeholder="">
<br>
<button onclick="zatwierdzModal()">OK</button>
</div>

<div id="produktyDiv">
<h3>💼 Zarządzaj produktami</h3>
<select id="listaProduktow" size="5" style="width:100%;"></select><br>
<input type="text" id="nowaNazwa" placeholder="Nazwa produktu">
<input type="number" id="nowaCena" placeholder="Cena produktu"><br>
<select id="nowaKategoria">
  <option value="jedzenie">Jedzenie</option>
  <option value="desery">Desery</option>
  <option value="napoje">Napoje</option>
</select><br>
<button onclick="zmienCene()">💾 Zmień cenę/nazwę</button>
<button onclick="dodajNowyProdukt()">➕ Dodaj nowy produkt</button>
<button onclick="usunProdukt()">🗑️ Usuń produkt</button>
<br><br>
<button onclick="zapiszPreset()">💾 Zapisz preset (kasjer1)</button>
<select id="listaPresetow"></select>
<button onclick="wczytajPreset()">📂 Wczytaj preset</button>
<br><br>
<button onclick="zamknijProdukty()">Zamknij</button>
</div>

<h2>Potwierdzenie klienta:</h2>
<pre id="paragon"></pre>
<h2>Potwierdzenie kuchni:</h2>
<pre id="paragonKuchnia"></pre>

<script>
// Loginy i hasła
const kasjerzy = { "kasjer1":"A1b2C3d4", "kasjer2":"X9y8Z7w6", "kasjer3":"M4n5O6p7" };
let zalogowanyKasjer=null;

// Produkty i kategorie
let produkty = {
  "F_m":["Frytki małe",8], "F_s":["Frytki średnie",10], "F_l":["Frytki duże",12],
  "b":["Burger klasyczny",18], "bk":["Burger Królewski",24],
  "pz_m":["Pizza margherita mała",20], "pz_l":["Pizza margherita duża",26],
  "ph_m":["Pizza hawajska mała",22], "ph_l":["Pizza hawajska duża",28],
  "w":["Wata cukrowa",7], "g":["Gofr suchy",10], "gn":["Gofr nutella",14],
  "gb":["Gofr bita śmietana",13], "gbo":["Gofr bita śmietana + owoce",15],
  "l_m":["Lody w rożku małe",6], "l_l":["Lody w rożku duże",9],
  "c_m":["Gorąca czekolada mała",7], "c_l":["Gorąca czekolada duża",9],
  "k":["Kawa",7], "t":["Herbata",6],
  "s":["Sok pomarańczowy",8], "cola_m":["Cola mała",4], "cola_l":["Cola duża",6]
};
let kategorie = { 
  "jedzenie":["F_m","F_s","F_l","b","bk","pz_m","pz_l","ph_m","ph_l"], 
  "desery":["w","g","gn","gb","gbo","l_m","l_l"], 
  "napoje":["c_m","c_l","k","t","s","cola_m","cola_l"] 
};

let kursy={USD:4.2,EUR:4.7};
let zamowienie={}, notatki={}, numer=1, sumaPLN=0;
let wybranaPlatnosc='', sumaDoZaplaty=0, pokazanoReszte=false;
let rabatPromocyjny=false, modalTyp=null, aktualnyKod=null, aktualnyIndeks=null;

// Generowanie przycisków produktów
function generujPrzyciski(){
  for(let kat in kategorie){
    let div=document.getElementById(kat+"Grid");
    div.innerHTML="";
    kategorie[kat].forEach(kod=>{
      let [nazwa,cena]=produkty[kod];
      let btn=document.createElement("button");
      btn.textContent=`${nazwa} (${cena} zł)`;
      btn.dataset.kod=kod;
      btn.onclick=()=>dodaj(kod);
      div.appendChild(btn);
    });
  }
}
generujPrzyciski();

// Wyszukiwanie produktów
function filtrujProdukty(){
  let filter=document.getElementById("szukajProduktow").value.toLowerCase();
  for(let kat in kategorie){
    kategorie[kat].forEach(kod=>{
      let btn=document.querySelector(`button[data-kod='${kod}']`);
      btn.style.display=produkty[kod][0].toLowerCase().includes(filter) ? "block" : "none";
    });
  }
}

// Modal
function pokazModal(msg,typ=null,kod=null,indeks=null){
  document.getElementById("komunikatText").textContent=msg;
  document.getElementById("komunikatDiv").style.display='block';
  document.getElementById("overlay").style.display='block';
  modalTyp=typ; aktualnyKod=kod; aktualnyIndeks=indeks;
  let input=document.getElementById("modalInput");
  if(typ){ input.value=""; input.style.display='block'; input.placeholder=(typ==="notatka"?"Wpisz notatkę":"Wpisz kod promocyjny"); } 
  else input.style.display='none';
}
function zamknijModal(){ 
  document.getElementById("komunikatDiv").style.display='none'; 
  document.getElementById("overlay").style.display='none'; 
  modalTyp=null; aktualnyKod=null; aktualnyIndeks=null; 
  document.getElementById("modalInput").value=''; 
}
function zatwierdzModal(){
  if(modalTyp==="notatka"){
    notatki[aktualnyKod][aktualnyIndeks] = document.getElementById("modalInput").value;
    aktualizujKoszyk();
    zamknijModal();
  }
  else if(modalTyp==="kod"){
    let val=document.getElementById("modalInput").value.trim().toUpperCase();
    if(val==="PROMO10"){ rabatPromocyjny=true; aktualizujKoszyk(); zamknijModal(); }
    else { document.getElementById("komunikatText").textContent="Niepoprawny kod."; modalTyp="info"; }
  } else { zamknijModal(); }
}

// Logowanie i wylogowanie
function zaloguj(){
  let user=document.getElementById("loginUser").value.trim();
  let pass=document.getElementById("loginPass").value.trim();
  if(kasjerzy[user] && kasjerzy[user]===pass){ 
    zalogowanyKasjer=user; 
    document.getElementById("loginDiv").style.display="none"; 
    document.getElementById("app").style.display="block"; 
    document.getElementById("kasjerInfo").textContent="👨‍💼 Zalogowany: "+user; 
  } else pokazModal("Nieprawidłowe dane logowania!");
}
function wyloguj(){ zalogowanyKasjer=null; resetuj(); document.getElementById("app").style.display='none'; document.getElementById("loginDiv").style.display='block'; document.getElementById("loginUser").value=''; document.getElementById("loginPass").value=''; }

// Koszyk
function dodaj(kod){ 
  if(!zamowienie[kod]) zamowienie[kod]=0; 
  zamowienie[kod]++; 
  if(!notatki[kod]) notatki[kod]=[]; 
  notatki[kod].push(""); 
  aktualizujKoszyk(); 
}
function dodajNotatke(kod,i){ pokazModal("Dodaj notatkę:","notatka",kod,i); }
function aktualizujKoszyk(){
  let tekst="", suma=0;
  for(let kod in zamowienie){
    let [nazwa,cena]=produkty[kod], ilosc=zamowienie[kod];
    suma+=cena*ilosc;
    let notatkiLinie = notatki[kod];
    tekst += `<div><b>${ilosc}x ${nazwa} = ${(cena*ilosc).toFixed(2)} zł</b></div>`;
    for(let i=0;i<ilosc;i++){
      if(notatkiLinie[i] && notatkiLinie[i].trim()!=="") tekst += `<div>• Notatka: ${notatkiLinie[i]} <button class="notaBtn" onclick="dodajNotatke('${kod}',${i})">+</button></div>`;
      else tekst += `<div><button class="notaBtn" onclick="dodajNotatke('${kod}',${i})">Dodaj notatkę</button></div>`;
    }
  }
  sumaPLN=suma;
  if(rabatPromocyjny){ let r=(suma*0.1).toFixed(2); suma=(suma-r).toFixed(2); tekst+=`<div><b>Rabat promocyjny -10% (-${r} zł)</b></div>`; }
  if(tekst==="") tekst="Koszyk jest pusty.";
  tekst += `<br><br>`;
  document.getElementById("koszyk").innerHTML=tekst;
}

// Kod promocyjny
function otworzKodPromocyjny(){ pokazModal("Wpisz kod promocyjny:","kod"); }

// Płatność
function wybierzPlatnosc(){
  if(Object.keys(zamowienie).length===0) return pokazModal("Koszyk jest pusty!");
  document.getElementById("platnoscDiv").style.display='block';
  document.getElementById("overlay").style.display='block';
  document.getElementById("gotowkaInputDiv").style.display='block';
  document.getElementById("gotowkaInput").value='';
  document.getElementById("resztaText").textContent='';
  pokazanoReszte=false;
  aktualizujWalute();
}
function aktualizujWalute(){
  let wal=document.getElementById("platnoscSelect").value;
  let kwotaDoZaplaty=sumaPLN;
  if(rabatPromocyjny) kwotaDoZaplaty=(kwotaDoZaplaty*0.9).toFixed(2);
  if(wal==='USD'||wal==='EUR') kwotaDoZaplaty=(kwotaDoZaplaty*1.2/kursy[wal]).toFixed(2);
  document.getElementById("gotowkaInput").placeholder=`min: ${kwotaDoZaplaty} ${wal}`;
}
function zatwierdzPlatnosc(){
  wybranaPlatnosc=document.getElementById("platnoscSelect").value;
  let kwota=parseFloat(document.getElementById("gotowkaInput").value);
  sumaDoZaplaty=sumaPLN;
  if(rabatPromocyjny) sumaDoZaplaty=(sumaDoZaplaty*0.9).toFixed(2);
  if(wybranaPlatnosc==='USD'||wybranaPlatnosc==='EUR') sumaDoZaplaty=(sumaDoZaplaty*1.2/kursy[wybranaPlatnosc]).toFixed(2);
  if(wybranaPlatnosc==='BLIK'){ pokazParagon(); return;}
  if(!pokazanoReszte){
    if(isNaN(kwota)||kwota<sumaDoZaplaty) return pokazModal(`Za mała kwota! Minimalnie ${sumaDoZaplaty} ${wybranaPlatnosc}`);
    document.getElementById("resztaText").textContent=`Reszta: ${(kwota-sumaDoZaplaty).toFixed(2)} ${wybranaPlatnosc}`;
    pokazanoReszte=true; return;
  }
  pokazParagon(kwota,(kwota-sumaDoZaplaty).toFixed(2));
}

// Paragon
function pokazParagon(kwota=null,reszta=null){
  let teraz=new Date();
  let godzina=teraz.toLocaleTimeString();
  let linie="********** POTWIERDZENIE **********\n";
  linie+="Godzina: "+godzina+"\n";
  linie+="Kasjer: "+zalogowanyKasjer+"\n";
  linie+="Zamówienie nr #"+numer+"\n";
  linie+="------------------------------------\n";
  for(let kod in zamowienie){
    let [nazwa,cena]=produkty[kod],ilosc=zamowienie[kod];
    linie+=`${ilosc}x ${nazwa} ${cena*ilosc} zł\n`;
  }
  linie+="------------------------------------\n";
  if(rabatPromocyjny) linie+="Rabat -10%\n";
  linie+="SUMA: "+sumaDoZaplaty+" "+wybranaPlatnosc+"\n";
  if(reszta) linie+="Reszta: "+reszta+" "+wybranaPlatnosc+"\n";
  linie+="************************************\n";
  linie+="Dziękujemy – Zapraszamy ponownie!\n";
  document.getElementById("paragon").textContent=linie;

  let linieK="********** KUCHNIA **********\n";
  linieK+="Godzina: "+godzina+"\n";
  linieK+="Zamówienie nr #"+numer+"\n";
  linieK+="------------------------------------\n";
  for(let kod in zamowienie){
    let [nazwa]=produkty[kod],ilosc=zamowienie[kod];
    for(let i=0;i<ilosc;i++){
      linieK+=`${nazwa}`;
      if(notatki[kod][i] && notatki[kod][i].trim()!=="") linieK+=" ["+notatki[kod][i]+"]";
      linieK+="\n";
    }
  }
  linieK+="************************************\n";
  document.getElementById("paragonKuchnia").textContent = linieK;

  numer++; zamowienie={}; notatki={}; rabatPromocyjny=false; aktualizujKoszyk();
  document.getElementById("platnoscDiv").style.display='none'; document.getElementById("overlay").style.display='none';
}

// Reset i tryb
function resetuj(){ zamowienie={}; notatki={}; rabatPromocyjny=false; document.getElementById("paragon").textContent=""; document.getElementById("paragonKuchnia").textContent=""; aktualizujKoszyk(); }
function toggleDarkMode(){ document.body.classList.toggle("dark"); }

// ---------------- Zarządzanie produktami ----------------
function otworzProdukty(){
  odswiezListePresetow();
  let select=document.getElementById("listaProduktow");
  select.innerHTML="";
  for(let kod in produkty){
    let opt=document.createElement("option");
    opt.value=kod;
    opt.textContent=`${produkty[kod][0]} (${produkty[kod][1]} zł)`;
    select.appendChild(opt);
  }
  document.getElementById("produktyDiv").style.display='block';
  document.getElementById("overlay").style.display='block';
}

function zamknijProdukty(){ document.getElementById("produktyDiv").style.display='none'; document.getElementById("overlay").style.display='none'; }

function zmienCene(){
  let select=document.getElementById("listaProduktow");
  let kod=select.value;
  if(!kod) return;
  let nazwa=document.getElementById("nowaNazwa").value.trim();
  let cena=parseFloat(document.getElementById("nowaCena").value);
  let kat=document.getElementById("nowaKategoria").value;
  if(nazwa) produkty[kod][0]=nazwa;
  if(!isNaN(cena)) produkty[kod][1]=cena;
  if(kat !== null && kat!==undefined){
    // usuń z poprzedniej kategorii
    for(let k in kategorie){ kategorie[k]=kategorie[k].filter(x=>x!==kod); }
    kategorie[kat].push(kod);
  }
  generujPrzyciski();
  otworzProdukty();
}

function dodajNowyProdukt(){
  let nazwa=document.getElementById("nowaNazwa").value.trim();
  let cena=parseFloat(document.getElementById("nowaCena").value);
  let kat=document.getElementById("nowaKategoria").value;
  if(!nazwa || isNaN(cena)) return pokazModal("Wpisz nazwę i cenę produktu!");
  let kod=nazwa.toLowerCase().replace(/\s+/g,'_')+"_"+Math.floor(Math.random()*1000);
  produkty[kod]=[nazwa,cena];
  kategorie[kat].push(kod);
  generujPrzyciski();
  otworzProdukty();
}

function usunProdukt(){
  let select=document.getElementById("listaProduktow");
  let kod=select.value;
  if(!kod) return;
  delete produkty[kod];
  for(let k in kategorie){ kategorie[k]=kategorie[k].filter(x=>x!==kod); }
  generujPrzyciski();
  otworzProdukty();
}

// ---------------- Presety ----------------
function zapiszPreset() {
  if(zalogowanyKasjer !== "kasjer1") return pokazModal("Tylko kasjer1 może zapisywać presety!");
  let presetName = prompt("Podaj nazwę presetu:");
  if(!presetName) return;
  let preset = {produkty: JSON.parse(JSON.stringify(produkty)), kategorie: JSON.parse(JSON.stringify(kategorie))};
  let wszystkiePresety = JSON.parse(localStorage.getItem("presety")) || {};
  wszystkiePresety[presetName] = preset;
  localStorage.setItem("presety", JSON.stringify(wszystkiePresety));
  pokazModal("Preset zapisany!");
  odswiezListePresetow();
}

function odswiezListePresetow() {
  let select = document.getElementById("listaPresetow");
  select.innerHTML = "";
  let wszystkiePresety = JSON.parse(localStorage.getItem("presety")) || {};
  for(let key in wszystkiePresety) {
    let opt = document.createElement("option");
    opt.value = key;
    opt.textContent = key;
    select.appendChild(opt);
  }
}

function wczytajPreset(){
  let select = document.getElementById("listaPresetow");
  let presetName = select.value;
  if(!presetName) return pokazModal("Wybierz preset do wczytania!");
  let wszystkiePresety = JSON.parse(localStorage.getItem("presety")) || {};
  let preset = wszystkiePresety[presetName];
  if(!preset) return pokazModal("Preset nie znaleziony!");
  produkty = preset.produkty;
  kategorie = preset.kategorie;
  generujPrzyciski();
  pokazModal("Preset wczytany!");
  otworzProdukty();
}

// Inicjalizacja listy presetów przy ładowaniu
odswiezListePresetow();
</script>
</body>
</html>
