<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Kasa ≈öwiƒÖteczna</title>
<style>
  body { font-family: Arial, sans-serif; margin: 30px; }
  h1 { text-align: center; }
  .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
  button { padding: 15px; font-size: 16px; border-radius: 10px; cursor: pointer; }
  input[type="text"] { margin-bottom:5px; width: 80%; }
  #koszyk { background: #e0f7fa; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
  #platnoscDiv {
    display: none; 
    position: fixed; 
    top: 50%; left: 50%; 
    transform: translate(-50%, -50%);
    background: white; 
    padding: 20px; 
    border-radius: 15px; 
    box-shadow: 0 0 15px rgba(0,0,0,0.5); 
    z-index: 1001;
    width: 300px;
    text-align: center;
  }
  #overlay {
    display: none;
    position: fixed; 
    top:0; left:0; width:100%; height:100%; 
    background: rgba(0,0,0,0.5); 
    z-index: 1000;
  }
  #resztaText { margin-top: 15px; font-weight: bold; }
</style>
</head>
<body>

<h1>üéÑ Kasa ≈öwiƒÖteczna üçü‚òï</h1>

<div class="grid">
  <button onclick="dodaj('F')">Frytki du≈ºe (12 z≈Ç)</button>
  <button onclick="dodaj('f')">Frytki ma≈Çe (8 z≈Ç)</button>
  <button onclick="dodaj('c')">GorƒÖca czekolada (9 z≈Ç)</button>
  <button onclick="dodaj('g')">Gofr suchy (10 z≈Ç)</button>
  <button onclick="dodaj('gb')">Gofr bita ≈õmietana (13 z≈Ç)</button>
  <button onclick="dodaj('gn')">Gofr z nutellƒÖ (14 z≈Ç)</button>
  <button onclick="dodaj('gbo')">Gofr bita ≈õmiana + owoce (15 z≈Ç)</button>
</div>

<h2>Koszyk:</h2>
<div id="koszyk">Koszyk jest pusty.</div>

<button onclick="wybierzPlatnosc()">üßæ Wystaw paragon</button>
<button onclick="resetuj()">‚ùå Resetuj</button>
<button onclick="kodPromocyjny()">üéÅ Kod promocyjny</button>

<div id="overlay"></div>
<div id="platnoscDiv">
<h3>Wybierz formƒô p≈Çatno≈õci:</h3>
<select id="platnoscSelect" onchange="aktualizujWalute()">
  <option value="PLN">Got√≥wka (PLN)</option>
  <option value="USD">USD</option>
  <option value="EUR">EUR</option>
  <option value="BLIK">BLIK</option>
</select>
<div id="gotowkaInputDiv">
  <label>Podaj kwotƒô otrzymanƒÖ od klienta: </label>
  <input type="number" id="gotowkaInput" min="0" step="0.01">
</div>
<div id="resztaText"></div>
<button onclick="zatwierdzPlatnosc()">Zatwierd≈∫ p≈Çatno≈õƒá</button>
</div>

<h2>Paragon:</h2>
<pre id="paragon"></pre>

<script>
const produkty = {
  "F": ["Frytki du≈ºe", 12],
  "f": ["Frytki ma≈Çe", 8],
  "c": ["GorƒÖca czekolada", 9],
  "g": ["Gofr suchy", 10],
  "gn": ["Gofr nutella", 14],
  "gb": ["Gofr bita ≈õmietana", 13],
  "gbo": ["Gofr bita ≈õmietana + owoce", 15]
};

let kursy = { USD: 4.2, EUR: 4.7 };
let zamowienie = {};
let notatki = {};
let numer = 1;
let sumaPLN = 0;
let wybranaPlatnosc = '';
let sumaDoZaplaty = 0;
let pokazanoReszte = false;
let rabatPromocyjny = false;

function dodaj(kod) {
  if (!zamowienie[kod]) zamowienie[kod] = 0;
  zamowienie[kod]++;
  if (!notatki[kod]) notatki[kod] = [];
  notatki[kod].push("");
  aktualizujKoszyk();
}

function aktualizujKoszyk() {
  let tekst = "";
  sumaPLN = 0;
  for (let kod in zamowienie) {
    let [nazwa, cena] = produkty[kod];
    let ilosc = zamowienie[kod];
    sumaPLN += cena * ilosc;

    // Sprawdzenie notatek
    let wszystkiePuste = notatki[kod].every(n => n.trim()==="");
    if(wszystkiePuste){
      tekst += `<div>${ilosc}x ${nazwa} = ${cena*ilosc} z≈Ç</div>`;
    } else {
      for(let i=0;i<ilosc;i++){
        let linia = `1x ${nazwa} = ${cena} z≈Ç`;
        if(notatki[kod][i].trim()!=="") linia += ` (Notatka: ${notatki[kod][i]})`;
        tekst += `<div>${linia}</div>`;
      }
    }

    // pola na notatki
    for(let i=0;i<ilosc;i++){
      tekst += `<input type="text" placeholder="Notatka do produktu" value="${notatki[kod][i]}" oninput="notatki['${kod}'][${i}]=this.value"><br>`;
    }
  }

  let sumaDoWyswietlenia = sumaPLN;
  if(rabatPromocyjny){
    let rabat = (sumaPLN*0.1).toFixed(2);
    sumaDoWyswietlenia = (sumaPLN - rabat).toFixed(2);
    tekst += `<div><b>Rabat promocyjny -10% (-${rabat} z≈Ç)</b></div>`;
  }

  tekst += `<div><b>Suma: ${sumaDoWyswietlenia} z≈Ç</b></div>`;
  document.getElementById("koszyk").innerHTML = tekst;
}

function kodPromocyjny(){
  let kod = prompt("Wpisz kod promocyjny:");
  if(kod && kod.trim().toUpperCase()==="PROMO10"){
    rabatPromocyjny=true;
    alert("Kod poprawny! Rabat -10% zastosowany.");
    aktualizujKoszyk();
  } else alert("Niepoprawny kod promocyjny.");
}

function wybierzPlatnosc(){
  if(Object.keys(zamowienie).length===0) return alert("Koszyk jest pusty!");
  document.getElementById("platnoscDiv").style.display='block';
  document.getElementById("overlay").style.display='block';
  document.getElementById("gotowkaInputDiv").style.display='block';
  document.getElementById("gotowkaInput").value='';
  document.getElementById("resztaText").textContent='';
  pokazanoReszte=false;
  aktualizujWalute();
}

function aktualizujWalute(){
  const waluta = document.getElementById("platnoscSelect").value;
  if(waluta==='PLN'){
    document.getElementById("gotowkaInput").placeholder="kwota w PLN";
    document.getElementById("gotowkaInputDiv").style.display='block';
  } else if(waluta==='USD' || waluta==='EUR'){
    let sumaWaluta = (sumaPLN*1.2/kursy[waluta]).toFixed(2);
    document.getElementById("gotowkaInput").placeholder=`kwota w ${waluta}, min: ${sumaWaluta}`;
    document.getElementById("gotowkaInputDiv").style.display='block';
  } else if(waluta==='BLIK'){
    document.getElementById("gotowkaInputDiv").style.display='none';
  }
}

function zatwierdzPlatnosc(){
  wybranaPlatnosc = document.getElementById("platnoscSelect").value;
  if(wybranaPlatnosc==='USD' || wybranaPlatnosc==='EUR'){
    sumaDoZaplaty = (sumaPLN*1.2/kursy[wybranaPlatnosc]).toFixed(2);
  } else if(wybranaPlatnosc==='PLN') sumaDoZaplaty=sumaPLN;

  if(rabatPromocyjny && wybranaPlatnosc!=='BLIK') sumaDoZaplaty=(sumaDoZaplaty*0.9).toFixed(2);

  if(wybranaPlatnosc==='BLIK'){
    pokazParagon(wybranaPlatnosc,sumaDoZaplaty);
    document.getElementById("platnoscDiv").style.display='none';
    document.getElementById("overlay").style.display='none';
  } else {
    let kwota=parseFloat(document.getElementById("gotowkaInput").value);
    if(isNaN(kwota) || kwota<sumaDoZaplaty) return alert("Kwota za ma≈Ça!");
    if(!pokazanoReszte){
      let reszta=(kwota-sumaDoZaplaty).toFixed(2);
      document.getElementById("resztaText").textContent=`Reszta: ${reszta} ${wybranaPlatnosc}`;
      pokazanoReszte=true;
      return;
    } else {
      let reszta=(kwota-sumaDoZaplaty).toFixed(2);
      pokazParagon(wybranaPlatnosc,kwota,reszta,sumaDoZaplaty);
      document.getElementById("platnoscDiv").style.display='none';
      document.getElementById("overlay").style.display='none';
    }
  }
}

function pokazParagon(platnosc, kwota=null, reszta=null, sumaDoZaplaty=null){
  let linie="====================================\n";
  linie+="   üéÑ KASA ≈öWIƒÑTECZNA üçü‚òï\n";
  linie+="   Zam√≥wienie nr "+numer+"\n";
  linie+=new Date().toLocaleString()+"\n";
  linie+="------------------------------------\n";
  linie+="Ilo≈õƒá   Produkt                  Cena\n";
  linie+="------------------------------------\n";

  for(let kod in zamowienie){
    let [nazwa,cena]=produkty[kod];
    let ilosc=zamowienie[kod];
    let wszystkiePuste = notatki[kod].every(n=>n.trim()==="");
    if(wszystkiePuste){
      linie+=`${ilosc}x ${nazwa.padEnd(22)} ${cena*ilosc} z≈Ç\n`;
    } else {
      for(let i=0;i<ilosc;i++){
        linie+=`1x ${nazwa.padEnd(22)} ${cena} z≈Ç`;
        if(notatki[kod][i].trim()!=="") linie+=` (Notatka: ${notatki[kod][i]})`;
        linie+="\n";
      }
    }
  }

  linie+="------------------------------------\n";
  let sumaFinal=sumaPLN;
  if(rabatPromocyjny){
    let rabat=(sumaPLN*0.1).toFixed(2);
    sumaFinal=(sumaPLN-rabat).toFixed(2);
    linie+=`Rabat promocyjny -10% (-${rabat} z≈Ç)\n`;
  }

  linie+="SUMA: "+(sumaDoZaplaty?sumaDoZaplaty:sumaFinal)+" "+platnosc+"\n";
  if(reszta!==null) linie+="Kwota otrzymana: "+kwota+" "+platnosc+"\n";
  if(reszta!==null) linie+="Reszta: "+reszta+" "+platnosc+"\n";
  linie+="P≈Çatno≈õƒá: "+platnosc+"\n";
  linie+="====================================\n";

  document.getElementById("paragon").textContent=linie;
  numer++;
  zamowienie={};
  notatki={};
  rabatPromocyjny=false;
  aktualizujKoszyk();
}

function resetuj(){
  zamowienie={};
  notatki={};
  rabatPromocyjny=false;
  document.getElementById("paragon").textContent="";
  document.getElementById("resztaText").textContent='';
  document.getElementById("platnoscDiv").style.display='none';
  document.getElementById("overlay").style.display='none';
  aktualizujKoszyk();
}
</script>
<!-- Dodaj przycisk drukowania obok innych -->
<button onclick="drukujParagon()">üñ® Drukuj paragon</button>

<script>
function drukujParagon() {
  const paragonTekst = document.getElementById("paragon").textContent;
  const oknoDruk = window.open('', '', 'width=400,height=600');
  oknoDruk.document.write('<pre style="font-family: monospace; font-size: 16px;">' + paragonTekst + '</pre>');
  oknoDruk.document.close();
  oknoDruk.focus();
  oknoDruk.print();
  oknoDruk.close();
}
</script>

</body>
</html>
